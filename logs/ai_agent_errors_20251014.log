2025-10-14 11:16:45 | ERROR    | ai_agent.app.middleware.error_handlers | dispatch            :136  | Unhandled exception in POST /middleware/sessions: E11000 duplicate key error collection: AI_agent_db.jds index: jd_id_1 dup key: { jd_id: "1" }, full error: {'index': 0, 'code': 11000, 'errmsg': 'E11000 duplicate key error collection: AI_agent_db.jds index: jd_id_1 dup key: { jd_id: "1" }', 'keyPattern': {'jd_id': 1}, 'keyValue': {'jd_id': '1'}}
Traceback (most recent call last):
  File "D:\Cloned Projects\Final AI agent APIs\.venv\Lib\site-packages\starlette\middleware\base.py", line 151, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Cloned Projects\Final AI agent APIs\.venv\Lib\site-packages\anyio\streams\memory.py", line 126, in receive
    raise EndOfStream from None
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\Cloned Projects\Final AI agent APIs\app\middleware\error_handlers.py", line 42, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Cloned Projects\Final AI agent APIs\.venv\Lib\site-packages\starlette\middleware\base.py", line 159, in call_next
    raise app_exc
  File "D:\Cloned Projects\Final AI agent APIs\.venv\Lib\site-packages\starlette\middleware\base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\Cloned Projects\Final AI agent APIs\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "D:\Cloned Projects\Final AI agent APIs\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "D:\Cloned Projects\Final AI agent APIs\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "D:\Cloned Projects\Final AI agent APIs\.venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "D:\Cloned Projects\Final AI agent APIs\.venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "D:\Cloned Projects\Final AI agent APIs\.venv\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "D:\Cloned Projects\Final AI agent APIs\.venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "D:\Cloned Projects\Final AI agent APIs\.venv\Lib\site-packages\fastapi\routing.py", line 123, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "D:\Cloned Projects\Final AI agent APIs\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "D:\Cloned Projects\Final AI agent APIs\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "D:\Cloned Projects\Final AI agent APIs\.venv\Lib\site-packages\fastapi\routing.py", line 109, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "D:\Cloned Projects\Final AI agent APIs\.venv\Lib\site-packages\fastapi\routing.py", line 387, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "D:\Cloned Projects\Final AI agent APIs\.venv\Lib\site-packages\fastapi\routing.py", line 288, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Cloned Projects\Final AI agent APIs\app\routers\middleware.py", line 234, in initialize_session_from_middleware
    await jds_coll.insert_one(jd_data)
  File "C:\Python313\Lib\concurrent\futures\thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "D:\Cloned Projects\Final AI agent APIs\.venv\Lib\site-packages\pymongo\synchronous\collection.py", line 891, in insert_one
    self._insert_one(
    ~~~~~~~~~~~~~~~~^
        document,
        ^^^^^^^^^
    ...<5 lines>...
        comment=comment,
        ^^^^^^^^^^^^^^^^
    ),
    ^
  File "D:\Cloned Projects\Final AI agent APIs\.venv\Lib\site-packages\pymongo\synchronous\collection.py", line 831, in _insert_one
    self._database.client._retryable_write(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        acknowledged, _insert_command, session, operation=_Op.INSERT
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "D:\Cloned Projects\Final AI agent APIs\.venv\Lib\site-packages\pymongo\synchronous\mongo_client.py", line 2082, in _retryable_write
    return self._retry_with_session(retryable, func, s, bulk, operation, operation_id)
           ~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Cloned Projects\Final AI agent APIs\.venv\Lib\site-packages\pymongo\synchronous\mongo_client.py", line 1968, in _retry_with_session
    return self._retry_internal(
           ~~~~~~~~~~~~~~~~~~~~^
        func=func,
        ^^^^^^^^^^
    ...<4 lines>...
        operation_id=operation_id,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "D:\Cloned Projects\Final AI agent APIs\.venv\Lib\site-packages\pymongo\_csot.py", line 125, in csot_wrapper
    return func(self, *args, **kwargs)
  File "D:\Cloned Projects\Final AI agent APIs\.venv\Lib\site-packages\pymongo\synchronous\mongo_client.py", line 2014, in _retry_internal
    ).run()
      ~~~^^
  File "D:\Cloned Projects\Final AI agent APIs\.venv\Lib\site-packages\pymongo\synchronous\mongo_client.py", line 2765, in run
    return self._read() if self._is_read else self._write()
                                              ~~~~~~~~~~~^^
  File "D:\Cloned Projects\Final AI agent APIs\.venv\Lib\site-packages\pymongo\synchronous\mongo_client.py", line 2897, in _write
    return self._func(self._session, conn, self._retryable)  # type: ignore
           ~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Cloned Projects\Final AI agent APIs\.venv\Lib\site-packages\pymongo\synchronous\collection.py", line 829, in _insert_command
    _check_write_command_response(result)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "D:\Cloned Projects\Final AI agent APIs\.venv\Lib\site-packages\pymongo\helpers_shared.py", line 322, in _check_write_command_response
    _raise_last_write_error(write_errors)
    ~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^
  File "D:\Cloned Projects\Final AI agent APIs\.venv\Lib\site-packages\pymongo\helpers_shared.py", line 292, in _raise_last_write_error
    raise DuplicateKeyError(error.get("errmsg"), 11000, error)
pymongo.errors.DuplicateKeyError: E11000 duplicate key error collection: AI_agent_db.jds index: jd_id_1 dup key: { jd_id: "1" }, full error: {'index': 0, 'code': 11000, 'errmsg': 'E11000 duplicate key error collection: AI_agent_db.jds index: jd_id_1 dup key: { jd_id: "1" }', 'keyPattern': {'jd_id': 1}, 'keyValue': {'jd_id': '1'}}
